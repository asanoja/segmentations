var NYTD=NYTD||{};NYTD.video=NYTD.video||{},NYTD.video.players=NYTD.video.players||{},function(e,t){t.Extended=function(t){this.options=e.extend({name:"",token:"cE97ArV7TzqBzkmeRVVhJ8O6GWME2iG_bRvjBTlNb4o.",thumbWidth:110,thumbsVisible:3,thumbsDistance:6,thumbsMax:null,videoWidth:368,videoHeight:207,playerType:"homepage",moreVideos:"http://www.nytimes.com/video",debug:!1},t),this.element=e("#"+this.options.container),this.video=null,this.rendered=!1,this.currentVideo=1,this.$allImgThumbs=null,this.$videoThumbsWrapper=null,this.scrollWindowWidth=0,this.thumbOuterWidth=0,this.initialize()},t.Extended.prototype={initialize:function(){var e=this;this.getData(function(t){e.playlist=t,e.setVideoIds(),e.render(),e.registerEvents(),e.setMoreVideosLink(),e.options.onReady&&typeof e.options.onReady=="function"&&e.options.onReady.call(e)})},getStaticDomain:function(){var e=window.location.host,t="http://js.nyt.com/";if(this.options.debug)return"http://static.local.nytimes.com/";switch(e){case"localhost":t="http://static.local.nytimes.com/";break;case"video-int01.qprvt.nytimes.com":t="http://video-int01.qprvt.nytimes.com/video/";break;case"www.dev.nytimes.com":t="http://static.dev.nytimes.com/";break;case"www.stg.nytimes.com":t="http://static.stg.nytimes.com/";break;default:t="http://js.nyt.com/"}return t},getGraphicsDomain:function(){var e=window.location.host,t="http://graphics8.nytimes.com/";if(this.options.debug)return"http://static.local.nytimes.com/";switch(e){case"localhost":t="http://static.local.nytimes.com/";break;case"video-int01.qprvt.nytimes.com":t="http://video-int01.qprvt.nytimes.com/video/";break;case"www.dev.nytimes.com":t="http://static.dev.nytimes.com/";break;case"www.stg.nytimes.com":t="http://static.stg.nytimes.com/";break;default:t="http://graphics8.nytimes.com/"}return t},videoIds:[],registerEvents:function(){var t=this,n="#"+this.options.container,r=n+" .videoThumbs li";e(n).on("click",r,function(n){var r=e(this);t.selectThumb(r)})},getData:function(t){var n="http://api.brightcove.com/services/library?",r="name%2CshortDescription%2ClongDescription%2CvideoStillURL%2CthumbnailURL%2CreferenceId%2Ctags",i="command=find_playlist_by_reference_id&reference_id="+this.options.referenceId+"&token="+this.options.token+"&video_fields="+r+"&custom_fields=videourl&media_delivery=http";e.ajax({url:n,async:!1,type:"get",dataType:"jsonp",data:i,cache:!0,success:t})},selectThumb:function(e){var t=e.index(),n=this.playlist.videos[t];this.element.find(".videoThumbs li").removeClass("thumbSelected"),e.addClass("thumbSelected"),this.currentVideo=t,this.renderVideo(n),this.updateShareTool(n),this.scrollTo(e)},setVideoIds:function(){var e=this.playlist.videos,t=this.options.thumbsMax||e.length;for(var n=0;n<t;n++)this.videoIds.push(e[n].referenceId)},getKicker:function(e){var t=/nyto_([^,]+)/.exec(e.join(","))[1];return t||""},render:function(){this.renderThumbs(),this.renderVideo(),this.updateShareTool()},renderVideo:function(e){var t=this,n=e?!1:!0,r=n?!1:!0,i=n?!1:!0,s=e||this.playlist.videos[0],o=this.options.thumbsMax||this.playlist.videos.length,u={backgroundImage:s.videoStillURL,buttonPosition:"bottomLeft",buttonAnimated:!0,buttonExpandBy:80,buttonFontColor:"#FFF",buttonFontSize:"12px",buttonPaddingLeftRight:20,buttonPaddingTopBottom:20,buttonHeight:42,buttonWidth:42},a=this.element.find(".extendedVideoPocketPlayerContainer");a.attr("id","video_"+s.referenceId),this.element.find(".videoDetails .kicker").html(this.getKicker(s.tags)),this.element.find(".videoDetails .shortDescription").attr("href",s.customFields.videourl).html(s.name),this.element.find(".videoDetails .longDescription").html(s.longDescription),this.video&&this.video.getVideoModule()?this.video.getVideoModule().loadVideo(s.referenceId,"referenceId"):(a.empty(),NYTD.Video.Factory.loadDependencies(function(){t.video=NYTD.Video.Factory.create({container:"video_"+s.referenceId,playerId:"2125004161001",publisherId:"1749339200",videoId:s.referenceId,width:t.options.videoWidth,height:t.options.videoHeight,autoStart:i,autoRender:r,playerType:t.options.playerType,adxAdPositions:"VideoPlayerAd,ADX_CLIENTSIDE",overlay:e?null:u,adCountdown:!0});var n=t.video.getSubscription();n.subscribe(NYTD.Video.VideoEvents.RENDERED,function(e){var n=t.element.find(".videoThumbs .thumbSelected");n.length===0&&t.element.find(".videoThumbs li:first").addClass("thumbSelected"),t.rendered=!0,t.video&&t.video.poster&&t.video.poster.onDestroyed()}),n.subscribe(NYTD.Video.VideoEvents.VIDEO_COMPLETE,function(){if(o>t.currentVideo+1){var e=t.element.find(".videoThumbs .thumbSelected").next();t.selectThumb(e)}})}))},renderThumbs:function(){var t=this.element.find("ul.videoThumbs"),n=this.playlist.videos,r=this.options.thumbsMax||n.length,i=parseInt(this.options.thumbWidth,10),s=[this.getGraphicsDomain(),"images/video/video-default-thumb-96x54-000000.png"].join("");for(var o=0;o<r;o++){var u,a,f,l,c;u=n[o].videoStillURL,a="",o<=this.options.thumbsVisible?(thumbImgSrc=u,a="videoImageLoaded"):(thumbImgSrc=s,a="videoImagePlaceholder"),f=e("<li></li>").css({width:i+4,"margin-right":this.options.thumbsDistance}),l=e('<img class="'+a+'" data-src="'+u+'" src="'+thumbImgSrc+'" />').css({width:i}).appendTo(f),c=e('<p class="shortDescription">'+n[o].name+"</p>").appendTo(f),t.append(f)}this.$allImgThumbs=e("img","#extVidPlayerThumbsWrapper .videoThumbs"),this.scrollWindowWidth=e("#extVidPlayerThumbsWrapper").width(),this.thumbOuterWidth=this.element.find(".videoThumbs li:first").outerWidth(),this.$videoThumbsWrapper=this.element.find(".videoThumbs"),"ontouchstart"in window?this.setTouchScroll():this.setRegularScroll()},setThumbsSize:function(){var e=this.element.find("ul.videoThumbs"),t=this.playlist.videos,n=this.options.thumbsMax||t.length,r=parseInt(this.options.thumbWidth,10),i=n*(r+this.options.thumbsDistance+4);e.css("width",i+"px")},scrollTo:function(e){var t=this.element.find(".videoThumbs"),n=this.currentVideo*(this.element.find(".videoThumbs li:first").outerWidth()+this.options.thumbsDistance)*-1,r={duration:"slow",easing:"swing",complete:function(){animating=!1}};"ontouchstart"in window?this.scroll.scrollToElement(e[0],500):(this.arrowsState(n),t.animate({marginLeft:n},r)),this.checkImages(n,0)},arrowsState:function(e){var t=this.element.find(".videoThumbs"),n=t.find("li:first").outerWidth(),r=(n+this.options.thumbsDistance)*this.options.thumbsVisible,i=this.element.find(".extVidPlayerNav .previousVideo"),s=this.element.find(".extVidPlayerNav .nextVideo"),o=this.element.find(".extVidPlayerThumbsContainer");e>=0?i.addClass("previousVideoInactive"):i.removeClass("previousVideoInactive"),e*-1+r>=t.width()?(s.addClass("nextVideoInactive"),o.removeClass("thumbsShadow")):(s.removeClass("nextVideoInactive"),o.addClass("thumbsShadow"))},setTouchScroll:function(){var e=this,t=this.element.find(".extVidPlayerThumbsContainer"),n=function(){e.scroll=new NYTD.video.iScroll("extVidPlayerThumbsWrapper",{vScrollbar:!1,hScrollbar:!1,snap:"li",onScrollMove:function(n){var r=e.$videoThumbsWrapper,i=e.$videoThumbsWrapper.position().left;i*-1+t.width()>r.width()?t.removeClass("thumbsShadow"):t.addClass("thumbsShadow"),e.checkImages(i,100)},onScrollEnd:function(t){var n=e.$videoThumbsWrapper.position().left;e.checkImages(n,100)}}),t.addClass("thumbsShadow"),e.setThumbsSize(),e.scroll.refresh()};window.iScroll?n():this.getScript(this.getStaticDomain()+"js2/build/video/2.0/iscroll.js",n)},setRegularScroll:function(){var t=this,n=this.element.find(".videoThumbs"),r=this.element.find(".extVidPlayerNavContent").show(),i=this.element.find(".videoThumbs li:first").outerWidth(),s=(i+this.options.thumbsDistance)*this.options.thumbsVisible,o=this.playlist.videos.length,u=Math.ceil(o/this.options.thumbsVisible),a=this.playlist.videos.length%this.options.thumbsVisible,f=!1,l={duration:"slow",easing:"swing",complete:function(){f=!1}};this.setThumbsSize(),this.arrowsState(0),e("#"+this.options.container).on("click",".extVidPlayerNav .previousVideo",function(e){e.preventDefault();var r=parseInt(n.css("marginLeft"),10),i=r*-1>s?r+s:r+r*-1;r<0&&!f&&(n.animate({marginLeft:i},l),f=!0),t.arrowsState(i)}),e("#"+this.options.container).on("click",".extVidPlayerNav .nextVideo",function(e){e.preventDefault();var r=parseInt(n.css("marginLeft"),10),i=r-s;r*-1+s<n.width()&&!f&&(n.animate({marginLeft:i},l),f=!0),t.arrowsState(i),t.checkImages(i,0)})},checkImages:function(t,n){var r,i,s,o;i=e("img.videoImagePlaceholder",".videoThumbs"),s=t,scrollWindowWidthOffset=n||0,r=this,i.each(function(){var t,n,i;t=e(this),n=r.$allImgThumbs.index(t),i=(r.thumbOuterWidth+r.options.thumbsDistance)*n,o=i+s,o<r.scrollWindowWidth+scrollWindowWidthOffset&&r.loadImage(t)})},loadImage:function(e){var t;t=e.attr("data-src"),t&&e.attr("src",t).removeClass("videoImagePlaceholder").addClass("videoImageLoaded")},getScript:function(t,n){e.ajax({url:t,dataType:"script",cache:!0,success:n})},updateShareTool:function(e){var t=e||this.playlist.videos[0],n=this.element.find(".shareTools"),r=function(){n.data("title",t.name),n.data("description",t.longDescription),n.data("url",t.customFields.videourl||"http://www.nytimes.com/video")};NYTD.shareTools?r():this.getScript(this.getStaticDomain()+"js/common/sharetools/2.0/shareTools.js",r)},setMoreVideosLink:function(){var e=this.element.find(".extVidPlayerSectionHeaderLink"),t=e.find("span");e.attr("href",this.options.moreVideos),t.html(this.options.name)}}}(NYTD.jQuery,NYTD.video.players);