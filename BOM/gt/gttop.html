<script src="jquery-min.js"></script>
<script>
var urlind;
var algoind;
var browserind;
var ttind;
var urls = [];
var algo = ["GT","BOM","VIPS"];
var browser = ["CHROME","FIREFOX","IEXPLORER"];

function add2log(s) {
	var opt = document.createElement("option");
	opt.innerHTML = s;
	logobj = document.getElementById("log");
	logobj.options[0].selected = false;
	logobj.insertBefore(opt,logobj.options[0]);
	opt.selected = true;
	console.log(s);
}
function add2struc(struc,level,s,events) {
	obj = document.getElementById(struc);
	var spc = "";
	for (var i=0;i<level;i++) 
		spc+="&nbsp;&nbsp;&nbsp;";
	if (events) {
		var ts = document.createElement("p");
		//~ ts.setAttribute("onmouseover=\""+hover+"\"");
		//~ ts.setAttribute("onmouseout=\""+hout+"\"");
		ts.innerHTML=spc+s;
	} else
		var ts = document.createTextNode(s);
	obj.appendChild(ts);
}

function loadPage() {
	var urll = document.getElementById("gturl");
	var url = urll.value;
	if (parent.contentWindow) {
		try {
			parent.contentWindow.close()
		} catch(err) {
			parent.contentWindow = undefined;
		}
	}
	parent.contentWindow 	= window.open(url,"_blank","left=0,top=0,width=1024,height=768");
	
	
	
}

function over(obj,container) {
	obj.style.borderColor = "red";
	//~ obj.scrollIntoView(true);
	obj.style.backgroundColor = "red";
	obj.style.zIndex="200000"
	obj.style.opacity = "0.5";
	container.style.backgroundColor = "red";
	
}

function out(obj,container) {
	obj.style.borderColor = parent.colors[obj.getAttribute("bomtype")];
	obj.style.backgroundColor = "transparent";
	container.style.backgroundColor = "transparent";
}

function loadURLS() {
	var opt;
	for (var i=document.getElementById("gturl").options.length-1;i>0;i--) {
		document.getElementById("gturl").removeChild(document.getElementById("gturl").options[i]);
	}
	var k=1;
	for (var i=0; i<urls.length; i++) {
		opt = document.createElement("option")
		opt.value = urls[i];
		
		
			if (urls[i].indexOf("-")==0) {
				opt.text = urls[i];
				opt.style.backgroundColor="#A52A2A";
				opt.style.color = "white";
			} else {
				opt.text = k +". " +urls[i];
				opt.setAttribute("parsed","true");
			}
		
		if (urls[i].indexOf("-")!=0) k++;
		document.getElementById("gturl").appendChild(opt);
	}
}

function advance() {
	browserind++;
	if (browserind >= browser.length) {
		browserind = 0;
		algoind++;
		if (algoind >= algo.length) {
			algoind=1;
			urlind++;
		}
	}
	setTimeout("processURL()",1000);
}

function step2() {
	if (!parent.batchmode) return;
	console.log("Step 2");
	if (parent.prepareEvaluation()) {
		var ttobj = document.getElementById("tt");
		for (var ttind=0;ttind<ttobj.options.length;ttind++) {
			ttobj.selectedIndex = ttind;
			console.log("evaluating URL:"+document.getElementById("gturl").value+", A:"+algo[algoind]+", TT:"+ttobj.value)
			parent.startEvaluation();
		}
		advance();
	} else {
		advance();
	}
}

function processURL() {
	if (!parent.batchmode) return;
	console.log("Step 1. "+urlind+" "+algoind,document.getElementById("gturl").options.length);
	var eurl = document.getElementById("gturl");
	if (urlind >= eurl.options.length) {
		console.log("Process finished");
		parent.evalDocument.getElementById("evaloutput").innerHTML = "Batch process finished<br><a href='report.php' target='_blank'>Open report</a>"
		parent.batchmode = false;
		return;
	}
	if (eurl.options[urlind].getAttribute("parsed"))  {
		
		
		if (algoind >= algo.length) return;
		if (browserind >= browser.length) return;
		
		eurl.selectedIndex = urlind;
		document.getElementById("right_algorithm").selectedIndex = algoind;
		document.getElementById("right_browser").selectedIndex = browserind;
		//~ document.getElementById("gturl").selectedIndex = urlind;
		parent.startFilter(algo[algoind]+"data");
		
	} else {
		while (!eurl.options[urlind].getAttribute("parsed")) {
			urlind++;
			if (!eurl.options[urlind]) break;
		}
		setTimeout("processURL()");
	}
	
}
</script>
<script src="../urllist.php"></script>
<form>	
<table>
	<tr>
	<td>
<img src="../images/gtlogo.png" height="64">
</td>
<td>
<a href="#" onclick='loadURLS()'>Open</a> 
<!--
<input type="text" name="url" id="url" value="http://www.upmc.fr/" size="40">
-->
<select name="gturl" id="gturl" value="gturl" onclick="parent.startFilter()">
<option value="">[URL]</option>	
</select>
<br>
<span style="border: 1px dotted red ">
	Left: <select name="left_algorithm" id="left_algorithm" onclick="parent.startFilter()">
	<option value="GTdata">GT</option>
	<option value="BOMdata">BOM</option>
	<option value="VIPSdata">VIPS</option> 
	<option value="BFdata">BF</option> 
</select>
on <select name="left_browser" id="left_browser" onclick="parent.startFilter()">
	<option value="chrome">Chrome</option> 
	<option value="firefox">Firefox</option>
	<option value="iexplorer">Internet Explorer</option> 
</select>
</span>
<span style="border: 1px dotted green ">
Right: <select name="right_algorithm" id="right_algorithm" onclick="parent.startFilter()">
	<option value="GTdata">GT</option>
	<option value="BOMdata">BOM</option>
	<option value="VIPSdata">VIPS</option> 
	<option value="BFdata">BF</option> 
</select>
on <select name="right_browser" id="right_browser" onclick="parent.startFilter()">
	<option value="chrome">Chrome</option> 
	<option value="firefox">Firefox</option>
	<option value="iexplorer">Internet Explorer</option> 
</select>
</span>
</td>
<td>
<!--
 either <input type='button' value="refresh" onclick="parent.setSegmentation(document.getElementById('algorithm').value)"> or <input type="button" value="Filter"  onclick="parent.startFilter(document.getElementById('algorithm').value)"> data, 
-->
<input type="button" value="load segmentations"  onclick="parent.prepareEvaluation()"> <br>
tt=
<select name="tt" id="tt">
<option value="0">0</option>
<option value="5">5</option>
<option value="10">10</option>
<option value="15">15</option>
<option value="20">20</option>
<option value="25" selected="true">25</option>
<option value="30">30</option>
<option value="35">35</option>
<option value="40">40</option>
<option value="45">45</option>
<option value="50">50</option>
</select>px
 
<input type="button" value="evaluate"  onclick="parent.startEvaluation()"> 
<input type="button" value="batch"  onclick="parent.batch()"> 
<input type="button" value="report"  onclick="window.open('report.php')"> 
</form>

	<input type="button" value="Reset evaluation data"  onclick="if (confirm('Are you sure you want to delete the data?')) {window.open('../reset.php','evaluacion')}"> 
</td>
</tr>
</table>
