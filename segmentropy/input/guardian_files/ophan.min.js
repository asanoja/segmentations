var module$ophan={};
define(function(){function startLog(){var pageinfo={v:8,url:location.href,ref:doc.referrer,gu_mi:getCookie("GU_MI"),s_vi:getCookie("s_vi")};for(var i=0;i<additionalDataGenerators.length;i++){var data=additionalDataGenerators[i]();for(var name in data)if(data.hasOwnProperty(name)&&data[name]!==null&&data[name]!==undefined&&data[name]!=="")pageinfo[name]=data[name]}var url=toQueryString(pageinfo);if(perf)url+="perf="+getPerformanceData()+"&";if(isModernBrowser){url+=getLocalStorageItems(["ophan_follow"]);body.addEventListener("click",
function(e){var target=e.target;if(target.nodeName.toLowerCase()==="a"&&target.parentNode){var info={from:[location.protocol,"//",location.host,location.pathname].join(""),to:this.href,sel:getPath(target),hash:makeHash(e.target.innerHTML)};additionalClickData(info)}},false)}createImage("http://ophan.guardian.co.uk/t.gif?"+url)}function createImage(url){var image=new Image;image.src=url.substring(0,url.length-1);image.style.display="none";body.appendChild(image)}function makeHash(s){var hash=0;var i=
0;for(var j=s.length-1;0<=j?i<=j:i>=j;0<=j?i++:i--){hash=(hash<<5)-hash+s.charCodeAt(i);hash=hash&hash}return hash}function getPerformanceData(){if(perf){var t=perf.timing;return[t.domainLookupEnd-t.domainLookupStart,t.connectEnd-t.connectStart,t.responseStart-t.connectEnd,t.responseEnd-t.responseStart,t.domContentLoadedEventStart-t.responseEnd,t.loadEventStart-t.domContentLoadedEventStart,perf.navigation.type,perf.navigation.redirectCount].join(",")}}function getCookie(name){var name_eq=name+"=";
var ca=doc.cookie.split(";");var i=0;for(var j=ca.length;i<j;++i){for(var c=ca[i];c.charAt(0)===" ";)c=c.substring(1,c.length);if(c.indexOf(name_eq)===0)return c.substring(name_eq.length,c.length)}return null}function getPath(elem,path){path=path||"";if(elem.nodeName.toLowerCase()==="html")return"html"+path;var id=elem.id;if(id)return"#"+id+path;var name=elem.nodeName.toLowerCase();var cls=elem.className;if(cls)name+="."+cls.trim().split(/[\s\n]+/).join(".");if(hasDupeElementSiblings(elem)){var c=
1;for(var e=elem;e=e.previousSibling;)if(e.nodeType===1)c++;name+=":nth-child("+c+")"}return getPath(elem.parentNode,">"+name+path)}function hasDupeElementSiblings(elem){var count=1;for(var sib=elem.parentNode.firstChild;sib;sib=sib.nextSibling)if(sib.nodeName===elem.nodeName){if(count>1)return true;count++}return false}function toQueryString(obj){var url="";for(var name in obj)if(obj.hasOwnProperty(name)&&obj[name]!==null&&obj[name]!==undefined&&obj[name]!=="")url+=encodeURIComponent(name)+"="+encodeURIComponent(obj[name])+
"&";return url}function getLocalStorageItems(items){var url="";var i=0;for(var l=items.length;i<l;i++){var item=storage.getItem(items[i]);if(item!==null){storage.removeItem(items[i]);url+=toQueryString(JSON.parse(item))}}return url}function additionalViewData(dataGenerator){additionalDataGenerators[additionalDataGenerators.length]=dataGenerator}function additionalClickData(data){if(isModernBrowser){var oldData=JSON.parse(storage.getItem("ophan_follow"));var newData=data;if(oldData!==null)for(var key in oldData)newData[key]=
oldData[key];storage.setItem("ophan_follow",JSON.stringify(newData))}}var doc=window.document;var storage=window.localStorage;var perf=window.performance||window.msPerformance||window.webkitPerformance||window.mozPerformance;var body=doc.body;var isModernBrowser=storage&&body.addEventListener&&JSON!==undefined;var additionalDataGenerators=[];return{"additionalClickData":additionalClickData,"additionalViewData":additionalViewData,"startLog":startLog}});