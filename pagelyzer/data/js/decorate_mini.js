var dump_loaded = true; var dump_text = ''; var cont=1; function puts(s) { dump_text += s; } function textNode(pNode) { return(pNode.nodeType==3); } function rgb2hex(rgbString) { if (rgbString != 'rgba(0, 0, 0, 0)') { var parts = rgbString.match(/^rgb\((\d+),\s*(\d+),\s*(\d+)\)$/); delete (parts[0]); for (var i = 1; i <= 3; ++i) { parts[i] = parseInt(parts[i]).toString(16); if (parts[i].length == 1) parts[i] = '0' + parts[i]; } return '#'+parts.join(''); } else { return '#ffffff' } } function css(pNode,prop) { return(document.defaultView.getComputedStyle(pNode,null).getPropertyValue(prop)); } function walk(pNode,nLevel,pretext) { var tab = ''; var src = ''; var aux = ''; for(var k=0;k<nLevel;k++) {tab+=' ';} var attr = \" uid='\"+cont+\"'\"; if (pNode.id) { attr += \" id='\"+(pNode.id)+\"'\"; } else { attr += \" id='element-\"+(cont)+\"'\"; } console.log('antes atributos'+$(pNode).prop('tagName')); if ($(pNode).prop('tagName')) { attr += \" elem_left='\"+$(pNode).offset().left+\"'\"; attr += \" elem_top='\"+$(pNode).offset().top+\"'\"; attr += \" elem_width='\"+$(pNode).width()+\"'\"; attr += \" elem_height='\"+$(pNode).height()+\"'\"; attr += \" className='\"+(new String(pNode.className))+\"'\"; if (pNode.style) { attr += \" margin_left='\"+(new String(css(pNode,'margin-left')))+\"'\"; attr += \" background_color='\"+(new String(css(pNode,'background-color')))+\"'\"; attr += \" font_size='\"+(new String(css(pNode,'font-size')))+\"'\"; attr += \" font_weight='\"+(new String(css(pNode,'font-weight')))+\"'\"; attr += \" display='\"+(new String(css(pNode,'display')))+\"'\"; attr += \" visibility='\"+(new String(css(pNode,'visibility')))+\"'\"; attr += \" style='\"+(pNode.style.cssText)+\"'\"; } console.log('luego atributos'+$(pNode).prop('tagName')); cont+=1; if (pNode.tagName == 'A') { if (pNode.href) attr += \" href='\"+pNode.href+\"'\"; } if ((pNode.tagName!='TBODY') && (pNode.tagName!='IMG') && (pNode.tagName!='CANVAS') && (pNode.id!='fxdriver-screenshot-canvas')) { if (!textNode(pNode) && (pNode.tagName)) { src += tab + '<'+pNode.tagName+' '+ attr+'>'; if (nLevel==0) { src += pretext; } } } if (pNode.tagName=='IMG') { src += tab + \"<\"+pNode.tagName+\" \"+ attr +\" src='\"+pNode.src+\"' alt='\"+pNode.alt+\"'/>\"; } for (var i = 0;i<pNode.childNodes.length;i++) { if (textNode(pNode.childNodes[i])) { src += pNode.childNodes[i].data.trim(); } else { src += walk(pNode.childNodes[i],nLevel+1,''); } } if ((pNode.tagName!='TBODY') && (pNode.tagName!='IMG') && (pNode.tagName!='CANVAS') && (pNode.id!='fxdriver-screenshot-canvas')) { if (!textNode(pNode) && (pNode.tagName)) { src += tab + '</'+pNode.tagName+'>'; } } } return(src); } function getDocHeight() { console.log('DOC H' + $(document).height()); return $(document).height(); } function getDocWidth() { console.log('DOC W' + $(document).width()); return $(document).width(); } function getOffset(obj) { return {x: $(obj).offset().left, y: $(obj).offset().top}; } function getElemLeft(element) { console.log('ELEM L' + getOffset(element).x); return getOffset(element).x; } function getElemTop(element) { console.log('ELEM T' + getOffset(element).y); return getOffset(element).y; } function getElemWidth(element) { console.log('ELEM W' + $(element).width()); return $(element).width(); } function getElemHeight(element) { console.log('ELEM H ' + $(element).height()); return $(element).height(); } function dump_start() { var src = ''; var now = new Date(); var then = now.getFullYear()+'-'+now.getMonth()+'-'+now.getDay()+' '+now.getHours()+':'+now.getMinutes()+':'+now.getSeconds(); pre = '<!-- window: {width : '+ $(window).width() + ', height: ' + $(window).height()+'}, '; pre += 'document: {width: '+ getDocWidth() + ', height: ' + getDocHeight()+'}, '; pre += 'page: {url: \"'+ location.href + '\", date: \"'+ then + '\"} -->'; src += walk(document.getElementsByTagName('html')[0],0,pre); return(src); }